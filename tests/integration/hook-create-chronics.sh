#!/usr/bin/env bash
#
# Integration test for hook create-chronics.
#
# Author: Ritesh Karki <ritesh.karki@rwth-aachen.de>
# SPDX-FileCopyrightText: 2014-2026 Institute for Automation of Complex Power Systems, RWTH Aachen University
# SPDX-License-Identifier: Apache-2.0

echo "Test not ready"
exit 99


DIR=$(mktemp -d)
pushd ${DIR}

function finish {
    popd
    rm -rf ${DIR}
}

trap finish EXIT

cat > config.conf << EOF
nodes = {

    file_node = {
        type = "file"
        format = {
        type = "csv"
        separator = ","
        delimiter = "\n"
        skip_first_line = false
        header = true
        }
        uris = ("./Load1.csv", "./SGen.csv")
        uri = "test_uri"
        in = {
            read_mode = "all"
        }

        hooks = (
            {
                type = "create_chronics"
                    loads_dir = "./"
                    sgens_dir = "./"
                    grid = "./grid_file.json"
                    output = "./test_output"
                    round_decimals = 3
                    compress = true
            }
        )
    },
    dummy_node = {
        type = "file"
        format = "csv"
        uri = "dummy"
        out = {

        }
    }
}

paths = (
    {
        in = "file_node",
        out = "dummy_node"
    }
)
EOF

cat > Load1.csv << EOF
secs,nsecs,offset,sequence,P_norm,Q_norm
0,83333333,0.0,0,0.016932429412331206,0.009857843460539759
0,166666666,0.0,1,0.016932429412331206,0.009282331392780813
0,250000000,0.0,2,0.016932429412331206,0.008983608863673546
0,333333333,0.0,3,0.016932429412331206,0.008961675873217962
0,416666666,0.0,4,0.016932429412331206,0.0092165235308626
0,500000000,0.0,5,0.016932429412331206,0.009670519541245412
0,583333333,0.0,6,0.016932429412331206,0.009857843460539759
0,666666666,0.0,7,0.01693242416294213,0.009700854102832137
0,750000000,0.0,8,0.01693241891355305,0.009267075206472835
0,833333333,0.0,9,0.016932429412331206,0.008961675873217962
0,916666666,0.0,10,0.01693245040988752,0.008852188731969274
1,0,0.0,11,0.016932476656832916,0.008909808395991422
1,83333333,0.0,12,0.016932429412331206,0.008961675873217962
1,166666666,0.0,13,0.016932303426993315,0.008978976886362093
1,250000000,0.0,14,0.01693216169348819,0.008967472512770878
1,333333333,0.0,15,0.016932429412331206,0.008961675873217962
1,416666666,0.0,16,0.016933174825580388,0.008967330263947493
1,500000000,0.0,17,0.016933993730276667,0.008978745732024092
1,583333333,0.0,18,0.016932429412331206,0.008961675873217962
1,666666666,0.0,19,0.016928077668784944,0.008910430734593728
1,750000000,0.0,20,0.016923321722279623,0.008853477861931195
1,833333333,0.0,21,0.016932429412331206,0.008961675873217962
1,916666666,0.0,22,0.016957783961581444,0.00926349231423384
2,0,0.0,23,0.01698551648408434,0.009693368258501533
EOF

cat > SGen1.csv << EOF
secs,nsecs,offset,sequence,P_norm,Q_norm
0,83333333,0.0,0,0.0,0.0
0,166666666,0.0,1,0.0,0.0
0,250000000,0.0,2,0.0,0.0
0,333333333,0.0,3,0.0,0.0
0,416666666,0.0,4,0.0,0.0
0,500000000,0.0,5,0.0,0.0
0,583333333,0.0,6,0.0,0.0
0,666666666,0.0,7,0.0,0.0
0,750000000,0.0,8,0.0,0.0
0,833333333,0.0,9,0.0,0.0
0,916666666,0.0,10,0.0,0.0
1,0,0.0,11,0.0,0.0
1,83333333,0.0,12,0.0,0.0
1,166666666,0.0,13,0.0,0.0
1,250000000,0.0,14,0.0,0.0
1,333333333,0.0,15,0.0,0.0
1,416666666,0.0,16,0.0,0.0
1,500000000,0.0,17,0.0,0.0
1,583333333,0.0,18,0.0,0.0
1,666666666,0.0,19,0.0,0.0
1,750000000,0.0,20,0.0,0.0
1,833333333,0.0,21,0.0,0.0
1,916666666,0.0,22,0.0,0.0
EOF

# TODO: Add an example grid net file

villas node confif.conf

# TODO: Compare with pre-generated csv files
